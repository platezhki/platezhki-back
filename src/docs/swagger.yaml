openapi: 3.0.0
info:
  title: Platezhki Backend API
  version: 1.0.0
  description: JWT Authentication API with refresh tokens
  contact:
    name: API Support
    email: support@platezhki.com

servers:
  - url: http://localhost:3001/api
    description: Development server
  - url: https://platezhki.com/api
    description: Production server

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        username:
          type: string
          example: john_doe
        email:
          type: string
          format: email
          example: john@example.com
        roleId:
          type: integer
          example: 1
        isActive:
          type: boolean
          example: true
        lastActivity:
          type: string
          format: date-time
          example: "2025-12-05T12:34:56.000Z"
        role:
          $ref: '#/components/schemas/Role'

    Role:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: USER

    AuthTokens:
      type: object
      properties:
        accessToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        refreshToken:
          type: string
          example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
    PaymentService:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "QIWI Wallet"
        description:
          type: string
          example: "Popular Russian payment system for online transactions"
        serviceUrl:
          type: string
          format: uri
          example: "https://qiwi.com"
        establishedAt:
          type: string
          format: date-time
          example: "2007-01-01T00:00:00.000Z"
        email:
          type: string
          format: email
          example: "support@qiwi.com"
        contacts:
          type: array
          items:
            type: string
          example: ["+7-800-707-77-59", "support@qiwi.com"]
        paymentPageExampleLink:
          type: string
          format: uri
          example: "https://qiwi.com/payment-example"
        ownerAverageRating:
          type: object
          nullable: true
          properties:
            average:
              type: number
              format: float
              example: 4.5
            count:
              type: integer
              example: 12
        paymentPageExampleImageUrls:
          type: array
          items:
            type: string
          example: ["/uploads/payment-pages/qiwi-payment.png"]
        cabinetExampleLink:
          type: string
          format: uri
          example: "https://qiwi.com/cabinet-example"
        cabinetExampleImageUrls:
          type: array
          items:
            type: string
          example: ["/uploads/cabinets/qiwi-cabinet.png"]
        logoUrl:
          type: string
          format: uri
          example: "/uploads/logos/qiwi-logo.png"
        slug:
          type: string
          example: "qiwi-wallet"
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
        countries:
          type: array
          items:
            $ref: '#/components/schemas/Country'
        currencies:
          type: array
          items:
            $ref: '#/components/schemas/Currency'
        paymentSystemTypes:
          type: array
          items:
            $ref: '#/components/schemas/PaymentSystemType'
        payInMethods:
          type: array
          items:
            $ref: '#/components/schemas/PaymentMethod'
        payOutMethods:
          type: array
          items:
            $ref: '#/components/schemas/PaymentMethod'
        supportServiceLanguages:
          type: array
          items:
            $ref: '#/components/schemas/Language'

    Country:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Russia"
        flagUrl:
          type: string
          example: "flags/ru.png"

    Currency:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "RUB"

    PaymentSystemType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "P2P Exchange"

    Offer:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Premium Exchange Offer"
        slug:
          type: string
          example: "premium-exchange-offer"
        trafficVolumeMin:
          type: integer
          example: 0
        trafficVolumeMax:
          type: integer
          example: 10000
        paymentMethods:
          type: array
          items:
            $ref: '#/components/schemas/PaymentMethod'
        payInFee:
          type: number
          format: float
          example: 2.0
        payOutFee:
          type: number
          format: float
          example: 3.0
        settleSpeedId:
          type: integer
          example: 1
        payInMinLimit:
          type: number
          format: float
          example: 10.0
        payInMaxLimit:
          type: number
          format: float
          example: 5000.0
        payOutMinLimit:
          type: number
          format: float
          example: 10.0
        payOutMaxLimit:
          type: number
          format: float
          example: 5000.0
        support247:
          type: boolean
          example: true
        automatics:
          type: boolean
          example: false
        legalPerson:
          type: boolean
          example: true
        isActive:
          type: boolean
          example: true
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        ownerId:
          type: integer
          example: 1
        countries:
          type: array
          items:
            $ref: '#/components/schemas/Country'
        currencies:
          type: array
          items:
            $ref: '#/components/schemas/Currency'
        paymentSystemTypes:
          type: array
          items:
            $ref: '#/components/schemas/PaymentSystemType'
        trafficSources:
          type: array
          items:
            $ref: '#/components/schemas/TrafficSource'
        trafficTypes:
          type: array
          items:
            $ref: '#/components/schemas/TrafficType'
        connectionTypes:
          type: array
          items:
            $ref: '#/components/schemas/ConnectionType'
        balanceTypes:
          type: array
          items:
            $ref: '#/components/schemas/BalanceType'
        ownerAverageRating:
          type: object
          nullable: true
          properties:
            average:
              type: number
              format: float
              example: 4.5
            count:
              type: integer
              example: 12

    TrafficSource:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Social Media"
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"

    TrafficType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Organic"
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"

    ConnectionType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "API"
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"

    BalanceType:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Digital"
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"

    OfferCreateRequest:
      type: object
      required:
        - name
        - countries
        - currencies
        - paymentSystemTypes
        - trafficVolumeMin
        - trafficVolumeMax
        - payInFee
        - payOutFee
        - payInMinLimit
        - payInMaxLimit
        - payOutMinLimit
        - payOutMaxLimit
        - support247
        - automatics
        - trafficSources
        - trafficTypes

    GoogleLoginRequest:
      type: object
      required:
        - code
      properties:
        code:
          type: string
          description: Authorization code received from Google OAuth
          example: "4/0AdQt8..."

    UserRating:
      type: object
      properties:
        id:
          type: integer
          example: 1
        raterId:
          type: integer
          example: 2
        ratedUserId:
          type: integer
          example: 10
        score:
          type: integer
          example: 5
        comment:
          type: string
          example: "Очень хороший пользователь"
        repliesCount:
          type: integer
          example: 3
        createdAt:
          type: string
          format: date-time
          example: "2025-11-21T12:34:56.000Z"
        updatedAt:
          type: string
          format: date-time
          example: "2025-11-21T12:35:56.000Z"

    UserRatingReply:
      type: object
      properties:
        id:
          type: integer
        authorId:
          type: integer
        userRatingId:
          type: integer
        comment:
          type: string
        author:
          type: object
          properties:
            id:
              type: integer
            username:
              type: string
        isFromRatedUser:
          type: boolean
          description: True if the reply author is the same user the rating was written about (rated user)
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    UserRatingCreateRequest:
      type: object
      required:
        - score
      properties:
        score:
          type: integer
          minimum: 0
          maximum: 5
          example: 4
        comment:
          type: string
          maxLength: 1000
          example: "Вежливый и пунктуальный"

    UserRatingUpdateRequest:
      type: object
      properties:
        score:
          type: integer
          minimum: 0
          maximum: 5
          example: 3
        comment:
          type: string
          maxLength: 1000
          example: "Обновлённый комментарий"

    UserRatingsList:
      type: object
      properties:
        data:
          type: array
          items:
            $ref: '#/components/schemas/UserRating'
        pagination:
          type: object
          properties:
            page:
              type: integer
            pageSize:
              type: integer
            total:
              type: integer

    AverageRatingResponse:
      type: object
      properties:
        average:
          type: number
          format: float
          example: 4.2
        count:
          type: integer
          example: 12

    PaymentMethod:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Bank Transfer"
        code:
          type: string
          example: "bank"

    Language:
      type: object
      properties:
        id:
          type: integer
          example: 1
        code:
          type: string
          example: "en"
        name:
          type: string
          example: "English"

    Success:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation completed"

    Error:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "An error occurred"

    CreateUserRequest:
      type: object
      required:
        - username
        - email
        - password
      properties:
        username:
          type: string
          example: "john_doe"
        email:
          type: string
          format: email
          example: "john@example.com"
        password:
          type: string
          format: password
          example: "securePass123"
        roleId:
          type: integer
          example: 3

    PaymentServiceCreateRequest:
      type: object
      required:
        - name
      properties:
        name:
          type: string
          example: "QIWI Wallet"
        description:
          type: string
        serviceUrl:
          type: string
          format: uri
        establishedAt:
          type: string
          example: "01.01.2007"
        email:
          type: string
          format: email
        contacts:
          type: array
          items:
            type: string
        countries:
          type: array
          items:
            type: integer
        currencies:
          type: array
          items:
            type: integer
        paymentSystemType:
          type: array
          items:
            type: integer
        payInMethods:
          type: array
          items:
            type: integer
        payOutMethods:
          type: array
          items:
            type: integer
        languageSupport:
          type: array
          items:
            type: integer

    PaymentServiceUpdateRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        serviceUrl:
          type: string
          format: uri
        establishedAt:
          type: string
        email:
          type: string
          format: email
        contacts:
          type: array
          items:
            type: string
        countries:
          type: array
          items:
            type: integer
        currencies:
          type: array
          items:
            type: integer
        paymentSystemType:
          type: array
          items:
            type: integer
        payInMethods:
          type: array
          items:
            type: integer
        payOutMethods:
          type: array
          items:
            type: integer
        languageSupport:
          type: array
          items:
            type: integer

    OfferUpdateRequest:
      type: object
      properties:
        name:
          type: string
        trafficVolumeMin:
          type: integer
        trafficVolumeMax:
          type: integer
        payInFee:
          type: number
        payOutFee:
          type: number
        payInMinLimit:
          type: number
        payInMaxLimit:
          type: number
        payOutMinLimit:
          type: number
        payOutMaxLimit:
          type: number
        support247:
          type: boolean
        automatics:
          type: boolean
        legalPerson:
          type: boolean
        isActive:
          type: boolean
        countries:
          type: array
          items:
            type: integer
        currencies:
          type: array
          items:
            type: integer

    Setting:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        value:
          type: string

    CreateSettingRequest:
      type: object
      required:
        - name
        - value
      properties:
        name:
          type: string
        value:
          type: string

    UpdateSettingRequest:
      type: object
      properties:
        name:
          type: string
        value:
          type: string

    EmailSendCodeRequest:
      type: object
      required: [email]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
    EmailVerifyRequest:
      type: object
      required: [email, code]
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        code:
          type: string
          example: "123456"
    PasswordResetRequest:
      type: object
      required:
        - email
      properties:
        email:
          type: string
          format: email
          example: user@example.com
    PasswordResetConfirm:
      type: object
      required:
        - email
        - code
        - newPassword
      properties:
        email:
          type: string
          format: email
          example: user@example.com
        code:
          type: string
          example: "123456"
        newPassword:
          type: string
          format: password
          minLength: 8
          example: "NewStrongPass123"

  parameters:
    PayInMethodsQuery:
      name: payInMethods
      in: query
      description: Filter by payment method IDs that are used as payIn methods. Can be passed as repeated params (?payInMethods=1&payInMethods=2) or as CSV (?payInMethods=1,2,3).
      style: form
      explode: false
      schema:
        type: array
        items:
          type: integer
        example: [1,2,3]
    PayOutMethodsQuery:
      name: payOutMethods
      in: query
      description: Filter by payment method IDs that are used as payOut methods. Can be passed as repeated params (?payOutMethods=4&payOutMethods=5) or as CSV (?payOutMethods=4,5).
      style: form
      explode: false
      schema:
        type: array
        items:
          type: integer
    PayMethodsQuery:
      name: payMethods
      in: query
      style: form
      explode: false
      schema:
        type: array
        items:
          type: integer

paths:
  /auth/login:
    post:
      summary: User login (email or username)
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                login:
                  type: string
                  description: Email or username (alternative to username)
                  example: user@example.com
                username:
                  type: string
                  description: Username (alternative to login)
                  example: john_doe
                password:
                  type: string
                  example: password123
              anyOf:
                - required: [login]
                - required: [username]
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          user:
                            $ref: '#/components/schemas/User'
                          accessToken:
                            type: string
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                          refreshToken:
                            type: string
                            example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/register:
    post:
      summary: User registration
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/refresh:
    post:
      summary: Refresh access token
      tags: [Authentication]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/AuthTokens'
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/logout:
    post:
      summary: User logout
      tags: [Authentication]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refreshToken
              properties:
                refreshToken:
                  type: string
                  example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
  /auth/google:
    post:
      summary: Login or register via Google OAuth
      description: Exchanges authorization code for tokens, verifies id_token, and logs in or registers a user based on Google email.
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GoogleLoginRequest'
      responses:
        '200':
          description: Successful Google login
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      accessToken:
                        type: string
                      refreshToken:
                        type: string
        '400':
          description: Bad Request
        '500':
          description: Server error
  /dictionaries:
    get:
      summary: Get all dictionaries
      tags: [Dictionaries]
      description: Returns all dictionary data as {id, name} objects for various entities
      responses:
        '200':
          description: Dictionaries retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          countries:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          currencies:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          languages:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          exchangeTypes:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          connectionTypes:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          paymentMethods:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          trafficTypes:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          trafficSources:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          paymentSystemTypes:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
                          balanceTypes:
                            type: array
                            items:
                              type: object
                              properties:
                                id:
                                  type: integer
                                name:
                                  type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/me:
    get:
      summary: Get current user
      tags: [Users]
      description: Returns information about the currently authenticated user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Current user retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/active/count:
    get:
      summary: Get active users count
      tags: [Users]
      description: >-
        Returns the number of unique active devices/users seen within the last 5 minutes.
        On first request from a device an httpOnly cookie named `pa_device` with a unique
        device hash will be set. Subsequent requests update the device last-seen timestamp.
      responses:
        '200':
          description: Active users count retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: object
                        properties:
                          activeCount:
                            type: integer
                            example: 12
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users:
    get:
      summary: Get all users
      tags: [Users]
      description: Returns a list of all users (requires authentication)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update current user
      tags: [Users]
      description: Updates the currently authenticated user. Only username and password can be changed.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                  example: "newusername"
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: "NewStrongPass123"
              anyOf:
                - required: [username]
                - required: [password]
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '400':
          description: Bad request (username already exists or missing fields)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Create new user
      tags: [Users]
      description: Creates a new user (requires admin or moderator role)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            examples:
              basic_user:
                summary: Create basic user
                value:
                  username: "john_doe"
                  email: "john@example.com"
                  password: "password123"
                  roleId: 3
              admin_user:
                summary: Create admin user
                value:
                  username: "admin_user"
                  email: "admin@example.com"
                  password: "securepassword"
                  roleId: 1
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '400':
          description: Bad request (username/email already exists or validation error)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied (insufficient permissions)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/{id}:
    get:
      summary: Get user by ID
      tags: [Users]
      description: Returns information about a specific user by ID (requires authentication)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: User ID
          example: 1
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/token/{userId}:
    get:
      summary: Admin - Get auth tokens for a user by ID
      tags: [Users]
      description: Returns a new set of access and refresh tokens for a specific user. This is an admin-only endpoint.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: userId
          required: true
          schema:
            type: integer
          description: User ID to generate tokens for
          example: 2
      responses:
        '200':
          description: Tokens generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    $ref: '#/components/schemas/User'
                  accessToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refreshToken:
                    type: string
                    example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '400':
          description: Invalid user ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (admin only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /roles:
    get:
      summary: Get all roles
      tags: [Roles]
      description: Returns all available roles
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Roles retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Create new role
      tags: [Roles]
      description: Creates a new role
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Moderator"
      responses:
        '201':
          description: Role created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Role'
        '400':
          description: Bad request (role name already exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /roles/{id}:
    patch:
      summary: Update role
      tags: [Roles]
      description: Updates an existing role
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Role ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Updated Role Name"
      responses:
        '200':
          description: Role updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Role'
        '400':
          description: Bad request (role name already exists)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Role not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services:
    get:
      summary: Get all payment services
      tags: [Payment Services]
      description: Returns paginated list of payment services with filtering and search capabilities.
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of items per page
        - in: query
          name: isActive
          schema:
            type: boolean
            default: true
          description: Filter by active status
        - in: query
          name: countryId
          schema:
            type: array
            items:
              type: integer
          style: form
          explode: false
          description: Filter by country IDs
        - in: query
          name: currencyId
          schema:
            type: array
            items:
              type: integer
          style: form
          explode: false
          description: Filter by currency IDs
        - in: query
          name: paymentMethodId
          schema:
            type: array
            items:
              type: integer
          style: form
          explode: false
          description: Filter by payment method IDs
        - in: query
          name: q
          schema:
            type: string
          description: Search query for payment service name
      responses:
        '200':
          description: Payment services retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/PaymentService'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
                  filters:
                    type: array
                    items:
                      type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Create or update payment service
      tags: [Payment Services]
      description: Creates a new payment service or updates existing one.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentServiceCreateRequest'
      responses:
        '200':
          description: Payment service updated successfully
        '201':
          description: Payment service created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services/my:
    get:
      summary: Get current user's payment service
      tags: [Payment Services]
      description: Returns the payment service owned by the current authenticated user.
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Payment service retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services/slug/{slug}:
    get:
      summary: Get payment service by slug
      tags: [Payment Services]
      description: Returns a payment service by its slug.
      parameters:
        - in: path
          name: slug
          required: true
          schema:
            type: string
          description: Payment service slug
      responses:
        '200':
          description: Payment service retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services/{id}:
    get:
      summary: Get payment service by id
      tags: [Payment Services]
      description: Returns a payment service by id
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Payment service id
      responses:
        '200':
          description: Payment service retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update payment service
      tags: [Payment Services]
      description: Updates an existing payment service with partial data
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Payment service id
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PaymentServiceUpdateRequest'
      responses:
        '200':
          description: Payment service updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete payment service
      tags: [Payment Services]
      description: Deletes an existing payment service by id.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Payment service id
      responses:
        '200':
          description: Payment service deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services/{id}/activate:
    post:
      summary: Activate payment service
      tags: [Payment Services]
      description: Activates an existing payment service.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Payment service id
      responses:
        '200':
          description: Payment service activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /payment-services/{id}/deactivate:
    post:
      summary: Deactivate payment service
      tags: [Payment Services]
      description: Deactivates an existing payment service.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
          description: Payment service id
      responses:
        '200':
          description: Payment service deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaymentService'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Payment service not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers:
    get:
      summary: Get offers
      tags: [Offers]
      description: Returns a paginated list of offers with optional filtering
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: isActive
          schema:
            type: boolean
            default: true
        - in: query
          name: countryId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: currencyId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: paymentMethodId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: paymentSystemTypeId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: trafficSourceId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: trafficTypeId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: connectionTypeId
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: sort_column
          schema:
            type: string
            enum: [name, id, createdAt]
            default: name
        - in: query
          name: order
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        '200':
          description: Offers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Offer'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
                  filters:
                    type: array
                    items:
                      type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Create offer
      tags: [Offers]
      description: Creates a new offer (requires authentication)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OfferCreateRequest'
      responses:
        '201':
          description: Offer created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '400':
          description: Validation error or offer already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/filter:
    get:
      summary: Filter offers and get payment services
      tags: [Offers]
      description: Filters offers based on criteria and returns payment services that have matching offers
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - in: query
          name: countries
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: currencies
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: paymentSystemTypes
          schema:
            type: array
            items:
              type: integer
        - $ref: '#/components/parameters/PayMethodsQuery'
        - in: query
          name: trafficSources
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: trafficTypes
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: connectionTypes
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: balanceTypes
          schema:
            type: array
            items:
              type: integer
        - in: query
          name: support247
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2]
        - in: query
          name: automatics
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2]
        - in: query
          name: legalPerson
          schema:
            type: array
            items:
              type: integer
              enum: [1, 2]
        - in: query
          name: payInFee
          schema:
            type: number
            format: float
        - in: query
          name: payOutFee
          schema:
            type: number
            format: float
        - in: query
          name: payInMinLimit
          schema:
            type: number
            format: float
        - in: query
          name: payInMaxLimit
          schema:
            type: number
            format: float
        - in: query
          name: payOutMinLimit
          schema:
            type: number
            format: float
        - in: query
          name: payOutMaxLimit
          schema:
            type: number
            format: float
        - in: query
          name: q
          schema:
            type: string
      responses:
        '200':
          description: Payment services with matching offers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      allOf:
                        - $ref: '#/components/schemas/PaymentService'
                        - type: object
                          properties:
                            offers:
                              type: array
                              items:
                                $ref: '#/components/schemas/Offer'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
                  filters:
                    type: array
                    items:
                      type: string
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/ranges:
    get:
      summary: Get offer ranges
      tags: [Offers]
      description: Returns min and max values for all numeric offer fields
      responses:
        '200':
          description: Offer ranges retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: object
                    properties:
                      trafficVolume:
                        type: object
                        properties:
                          min:
                            type: number
                            nullable: true
                          max:
                            type: number
                            nullable: true
                      payInFee:
                        type: object
                        properties:
                          min:
                            type: number
                            nullable: true
                          max:
                            type: number
                            nullable: true
                      payOutFee:
                        type: object
                        properties:
                          min:
                            type: number
                            nullable: true
                          max:
                            type: number
                            nullable: true
                      payInLimit:
                        type: object
                        properties:
                          min:
                            type: number
                            nullable: true
                          max:
                            type: number
                            nullable: true
                      payOutLimit:
                        type: object
                        properties:
                          min:
                            type: number
                            nullable: true
                          max:
                            type: number
                            nullable: true
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/my:
    get:
      summary: Get current user offers
      tags: [Offers]
      description: Returns offers for the authenticated user
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: currencyId
          schema:
            type: string
        - in: query
          name: q
          schema:
            type: string
        - in: query
          name: sort_column
          schema:
            type: string
            enum: [name, id, createdAt]
            default: name
        - in: query
          name: order
          schema:
            type: string
            enum: [asc, desc]
            default: asc
      responses:
        '200':
          description: User offers retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Offer'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/slug/{slug}:
    get:
      summary: Get offer by slug
      tags: [Offers]
      description: Returns an offer by its slug
      parameters:
        - in: path
          name: slug
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Offer retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/{id}:
    get:
      summary: Get offer by ID
      tags: [Offers]
      description: Returns an offer by its ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Offer retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    patch:
      summary: Update offer
      tags: [Offers]
      description: Updates an existing offer (requires authentication and ownership or admin role)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OfferUpdateRequest'
      responses:
        '200':
          description: Offer updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '400':
          description: Validation error or offer already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    delete:
      summary: Delete offer
      tags: [Offers]
      description: Deletes an offer (requires authentication and ownership or admin role)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Offer deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/{id}/activate:
    post:
      summary: Activate offer
      tags: [Offers]
      description: Activates an offer (requires authentication and ownership or admin role)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Offer activated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '400':
          description: Offer already active
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /offers/{id}/deactivate:
    post:
      summary: Deactivate offer
      tags: [Offers]
      description: Deactivates an offer (requires authentication and ownership or admin role)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Offer deactivated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Offer'
        '400':
          description: Offer already inactive
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Offer not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings:
    get:
      summary: Get all settings
      tags: [Settings]
      description: Returns a paginated list of all settings
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - in: query
          name: name
          schema:
            type: string
      responses:
        '200':
          description: Settings retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        type: array
                        items:
                          $ref: '#/components/schemas/Setting'
                      pagination:
                        type: object
                        properties:
                          page:
                            type: integer
                          limit:
                            type: integer
                          total:
                            type: integer
                          pages:
                            type: integer
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    post:
      summary: Create new setting
      tags: [Settings]
      description: Creates a new system setting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateSettingRequest'
      responses:
        '201':
          description: Setting created successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Setting'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings/{id}:
    get:
      summary: Get setting by ID
      tags: [Settings]
      description: Returns a specific setting by its ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Setting retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Setting'
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
    put:
      summary: Update setting
      tags: [Settings]
      description: Updates an existing setting by its ID
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateSettingRequest'
      responses:
        '200':
          description: Setting updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Setting'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /settings/name/{name}:
    get:
      summary: Get setting by name
      tags: [Settings]
      description: Returns a specific setting by its name
      parameters:
        - in: path
          name: name
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Setting retrieved successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/Setting'
        '404':
          description: Setting not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/{id}/ratings:
    post:
      tags:
        - Users
      summary: Create or update rating for a user
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UserRatingCreateRequest'
      responses:
        '201':
          description: Rating created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRating'
        '200':
          description: Rating updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRating'
        '400':
          description: Invalid request
        '401':
          description: Unauthorized
    get:
      tags:
        - Users
      summary: Get list of ratings for a user
      description: |
        Returns list of ratings for a specific user. Supports filtering by date range and score,
        pagination (page & limit), and sorting by date or by the number of ratings the rater has
        left (score). Each rating object contains `repliesCount` — the number of replies for that rating.
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: query
          name: page
          schema:
            type: integer
            default: 1
          description: Page number (1-based)
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
          description: Page size (maximum 100)
        - in: query
          name: startDate
          schema:
            type: string
            format: date-time
          description: ISO date-time. Include ratings created at or after this date.
        - in: query
          name: endDate
          schema:
            type: string
            format: date-time
          description: ISO date-time. Include ratings created at or before this date.
        - in: query
          name: score
          schema:
            type: integer
            minimum: 0
            maximum: 5
          description: Exact score to filter by (0-5)
        - in: query
          name: minScore
          schema:
            type: integer
            minimum: 0
            maximum: 5
          description: Minimum score (inclusive)
        - in: query
          name: maxScore
          schema:
            type: integer
            minimum: 0
            maximum: 5
          description: Maximum score (inclusive)
        - in: query
          name: sort_column
          schema:
            type: string
            enum: [createdAt, score, repliesCount]
            default: createdAt
          description: Sort column by creation date (createdAt), by score, or by number of replies (repliesCount).
        - in: query
          name: order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order (ascending or descending)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: List of ratings
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Ratings fetched successfully
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserRating'
        '401':
          description: Unauthorized
  /users/{id}/ratings/average:
    get:
      tags:
        - Users
      summary: Get average rating for a user
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Average rating and total count
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AverageRatingResponse'
        '401':
          description: Unauthorized
  /users/{id}/ratings/{ratingId}:
    delete:
      tags:
        - Users
      summary: Delete a rating
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID to delete
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Rating deleted
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Rating not found
    patch:
      tags:
        - Users
      summary: Update a rating by id
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID to update
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                score:
                  type: integer
                  minimum: 0
                  maximum: 5
                  example: 4
                comment:
                  type: string
                  example: "Updated comment"
      responses:
        '200':
          description: Rating updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRating'
        '400':
          description: Bad request
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Rating not found
  /users/{id}/ratings/{ratingId}/replies:
    post:
      tags:
        - Users
      summary: Create a reply to a user rating
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID to reply to
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [comment]
              properties:
                comment:
                  type: string
                  example: "Спасибо за отзыв"
      responses:
        '201':
          description: Reply created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRatingReply'
        '400':
          description: Invalid request
        '401':
          description: Unauthorized (authentication required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (insufficient permissions)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Rating not found
    get:
      tags:
        - Users
      summary: Get replies for a rating
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            default: 10
      responses:
        '200':
          description: List of replies
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/UserRatingReply'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                        example: 1
                      limit:
                        type: integer
                        example: 10
                      total:
                        type: integer
                        example: 42
                      pages:
                        type: integer
                        example: 5
        '404':
          description: Rating not found
  /users/{id}/ratings/{ratingId}/replies/{replyId}:
    patch:
      tags:
        - Users
      summary: Update a reply
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID
        - in: path
          name: replyId
          schema:
            type: integer
          required: true
          description: Reply ID to update
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                  example: "Обновлённый текст"
      responses:
        '200':
          description: Reply updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserRatingReply'
        '400':
          description: Invalid request
        '401':
          description: Unauthorized (authentication required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (only author or admin can edit)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Reply or rating not found
    delete:
      tags:
        - Users
      summary: Delete a reply
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: Rated user ID
        - in: path
          name: ratingId
          schema:
            type: integer
          required: true
          description: Rating ID
        - in: path
          name: replyId
          schema:
            type: integer
          required: true
          description: Reply ID to delete
      responses:
        '200':
          description: Reply deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '401':
          description: Unauthorized (authentication required)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (only author or admin can delete)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Reply or rating not found
  /users/email/send-code:
    post:
      summary: Send email verification code (current user)
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Verification code sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/email/verify:
    post:
      summary: Verify email with code (current user)
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [code]
              properties:
                code:
                  type: string
                  example: "123456"
      responses:
        '200':
          description: Email verified successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '400':
          description: Invalid code or expired
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/password/request-reset:
    post:
      summary: Request password reset link
      description: Sends a password reset link to the user email. The link contains a code parameter. The frontend URL is configured via environment variable.
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetRequest'
      responses:
        '200':
          description: Password reset link sent
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '400':
          description: Invalid email format
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /auth/password/reset:
    post:
      summary: Reset password using code
      description: Resets the user password using the code received in email link.
      tags: [Authentication]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PasswordResetConfirm'
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Success'
        '400':
          description: Invalid or expired code / validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/admin:
    get:
      summary: Admin - get users list with pagination, search, filters and sorting
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - in: query
          name: q
          schema:
            type: string
          description: Search by username or email (case-insensitive)
        - in: query
          name: id
          schema:
            type: integer
        - in: query
          name: ids
          schema:
            type: string
          description: Space-separated user IDs (e.g. "12 34 56"). When provided, takes precedence over id and q.
        - in: query
          name: roleId
          schema:
            type: integer
        - in: query
          name: ownerId
          schema:
            type: integer
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: emailVerified
          schema:
            type: boolean
        - in: query
          name: username
          schema:
            type: string
        - in: query
          name: email
          schema:
            type: string
        - in: query
          name: averageRatingMin
          schema:
            type: number
        - in: query
          name: averageRatingMax
          schema:
            type: number
        - in: query
          name: ratingsCountMin
          schema:
            type: integer
        - in: query
          name: ratingsCountMax
          schema:
            type: integer
        - in: query
          name: createdAtFrom
          schema:
            type: string
            format: date-time
        - in: query
          name: createdAtTo
          schema:
            type: string
            format: date-time
        - in: query
          name: updatedAtFrom
          schema:
            type: string
            format: date-time
        - in: query
          name: updatedAtTo
          schema:
            type: string
            format: date-time
        - in: query
          name: lastActivityFrom
          schema:
            type: string
            format: date-time
          description: Filter users with lastActivity >= this date
        - in: query
          name: lastActivityTo
          schema:
            type: string
            format: date-time
          description: Filter users with lastActivity <= this date
        - in: query
          name: sort_column
          schema:
            type: string
            enum: [id, username, email, roleId, averageRating, ratingsCount, createdAt, updatedAt, lastActivity, ownerId, isActive, emailVerified]
            default: createdAt
      responses:
        '200':
          description: Users list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/User'
                  pagination:
                    type: object
                    properties:
                      page:
                        type: integer
                      limit:
                        type: integer
                      total:
                        type: integer
                      pages:
                        type: integer
        '401':
          description: Unauthorized
        '403':
          description: Forbidden (admin or moderator only)
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
  /users/admin/{id}:
    patch:
      summary: Admin - update user by ID (edit all fields)
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                username:
                  type: string
                email:
                  type: string
                  format: email
                password:
                  type: string
                  format: password
                  minLength: 6
                roleId:
                  type: integer
                ownerId:
                  type: integer
                isActive:
                  type: boolean
                emailVerified:
                  type: boolean
              additionalProperties: false
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/Success'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/User'
        '400':
          description: Username or email conflict / validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '403':
          description: Forbidden (admin or moderator only)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
